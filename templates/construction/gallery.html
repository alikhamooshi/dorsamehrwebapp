{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Project Gallery" %} - Dorsamehr Kish{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="relative py-20" style="background-image: url('{% static 'images/Offy/logo/11111.png' %}'); background-size: cover; background-position: center; background-repeat: no-repeat;">
    <div class="absolute inset-0 bg-gradient-to-r from-[#0d1b2a]/20 to-[#1b263b]/20 bg-black/40"></div>
    <div class="container mx-auto px-6 relative z-10">
        <div class="text-center max-w-3xl mx-auto">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">
                {% trans "Project Gallery" %}
            </h1>
            <p class="text-lg text-white/90 leading-relaxed">
                {% trans "Explore our portfolio of exceptional construction projects, showcasing innovation, quality, and craftsmanship." %}
            </p>
        </div>
    </div>
</section>

<!-- Projects Section -->
<section class="py-16 bg-white">
    <div class="container mx-auto px-6">
        <!-- Section Header -->
        <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-[#0d1b2a] mb-4">
                {% trans "Our Projects" %}
            </h2>
            <p class="text-[#415a77] max-w-2xl mx-auto">
                {% trans "Select a project to explore our comprehensive gallery of construction achievements." %}
            </p>
        </div>

        <!-- Project Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Abnoos -->
            <button class="project-btn group bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-[#778da9] overflow-hidden hover:bg-[#415a77] hover:border-[#415a77]"
                    data-project="abnoos">
                <div class="p-6 text-center">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-[#415a77] to-[#1b263b] rounded-lg flex items-center justify-center group-hover:bg-white">
                        <i class="fas fa-building text-2xl text-white group-hover:text-[#415a77]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-[#0d1b2a] mb-2 group-hover:text-white">Abnoos</h3>
                    <p class="text-sm text-[#778da9] group-hover:text-white/80">{% trans "Modern Construction" %}</p>
                </div>
            </button>

            <!-- Dorsamehr Kish -->
            <button class="project-btn group bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-[#778da9] overflow-hidden hover:bg-[#415a77] hover:border-[#415a77]"
                    data-project="dorsamehrkish">
                <div class="p-6 text-center">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-[#415a77] to-[#1b263b] rounded-lg flex items-center justify-center group-hover:bg-white">
                        <i class="fas fa-building text-2xl text-white group-hover:text-[#415a77]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-[#0d1b2a] mb-2 group-hover:text-white">Dorsamehr Kish</h3>
                    <p class="text-sm text-[#778da9] group-hover:text-white/80">{% trans "Premium Development" %}</p>
                </div>
            </button>

            <!-- Emarat Farokh -->
            <button class="project-btn group bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-[#778da9] overflow-hidden hover:bg-[#415a77] hover:border-[#415a77]"
                    data-project="emaratfarokh">
                <div class="p-6 text-center">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-[#415a77] to-[#1b263b] rounded-lg flex items-center justify-center group-hover:bg-white">
                        <i class="fas fa-building text-2xl text-white group-hover:text-[#415a77]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-[#0d1b2a] mb-2 group-hover:text-white">Emarat Farokh</h3>
                    <p class="text-sm text-[#778da9] group-hover:text-white/80">{% trans "Luxury Construction" %}</p>
                </div>
            </button>

            <!-- Esperlos -->
            <button class="project-btn group bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-[#778da9] overflow-hidden hover:bg-[#415a77] hover:border-[#415a77]"
                    data-project="esperlos">
                <div class="p-6 text-center">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-[#415a77] to-[#1b263b] rounded-lg flex items-center justify-center group-hover:bg-white">
                        <i class="fas fa-building text-2xl text-white group-hover:text-[#415a77]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-[#0d1b2a] mb-2 group-hover:text-white">Esperlos</h3>
                    <p class="text-sm text-[#778da9] group-hover:text-white/80">{% trans "Innovative Design" %}</p>
                </div>
            </button>

            <!-- Gheytariye -->
            <button class="project-btn group bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-[#778da9] overflow-hidden hover:bg-[#415a77] hover:border-[#415a77]"
                    data-project="gheytariye">
                <div class="p-6 text-center">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-[#415a77] to-[#1b263b] rounded-lg flex items-center justify-center group-hover:bg-white">
                        <i class="fas fa-building text-2xl text-white group-hover:text-[#415a77]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-[#0d1b2a] mb-2 group-hover:text-white">Gheytariye</h3>
                    <p class="text-sm text-[#778da9] group-hover:text-white/80">{% trans "Urban Development" %}</p>
                </div>
            </button>

            <!-- Narbon -->
            <button class="project-btn group bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-[#778da9] overflow-hidden hover:bg-[#415a77] hover:border-[#415a77]"
                    data-project="narbon">
                <div class="p-6 text-center">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-[#415a77] to-[#1b263b] rounded-lg flex items-center justify-center group-hover:bg-white">
                        <i class="fas fa-building text-2xl text-white group-hover:text-[#415a77]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-[#0d1b2a] mb-2 group-hover:text-white">Narbon</h3>
                    <p class="text-sm text-[#778da9] group-hover:text-white/80">{% trans "Commercial Complex" %}</p>
                </div>
            </button>

            <!-- Narenjestan -->
            <button class="project-btn group bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-[#778da9] overflow-hidden hover:bg-[#415a77] hover:border-[#415a77]"
                    data-project="narenjestan">
                <div class="p-6 text-center">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-[#415a77] to-[#1b263b] rounded-lg flex items-center justify-center group-hover:bg-white">
                        <i class="fas fa-building text-2xl text-white group-hover:text-[#415a77]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-[#0d1b2a] mb-2 group-hover:text-white">Narenjestan</h3>
                    <p class="text-sm text-[#778da9] group-hover:text-white/80">{% trans "Residential Project" %}</p>
                </div>
            </button>

            <!-- Roshana -->
            <button class="project-btn group bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-[#778da9] overflow-hidden hover:bg-[#415a77] hover:border-[#415a77]"
                    data-project="roshana">
                <div class="p-6 text-center">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-[#415a77] to-[#1b263b] rounded-lg flex items-center justify-center group-hover:bg-white">
                        <i class="fas fa-building text-2xl text-white group-hover:text-[#415a77]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-[#0d1b2a] mb-2 group-hover:text-white">Roshana</h3>
                    <p class="text-sm text-[#778da9] group-hover:text-white/80">{% trans "Mixed Development" %}</p>
                </div>
            </button>

            <!-- Sadinva -->
            <button class="project-btn group bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-[#778da9] overflow-hidden hover:bg-[#415a77] hover:border-[#415a77]"
                    data-project="sadinva">
                <div class="p-6 text-center">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-[#415a77] to-[#1b263b] rounded-lg flex items-center justify-center group-hover:bg-white">
                        <i class="fas fa-building text-2xl text-white group-hover:text-[#415a77]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-[#0d1b2a] mb-2 group-hover:text-white">Sadinva</h3>
                    <p class="text-sm text-[#778da9] group-hover:text-white/80">{% trans "Specialized Project" %}</p>
                </div>
            </button>

            <!-- Sakra -->
            <button class="project-btn group bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-[#778da9] overflow-hidden hover:bg-[#415a77] hover:border-[#415a77]"
                    data-project="sakra">
                <div class="p-6 text-center">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-[#415a77] to-[#1b263b] rounded-lg flex items-center justify-center group-hover:bg-white">
                        <i class="fas fa-building text-2xl text-white group-hover:text-[#415a77]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-[#0d1b2a] mb-2 group-hover:text-white">Sakra</h3>
                    <p class="text-sm text-[#778da9] group-hover:text-white/80">{% trans "Modern Complex" %}</p>
                </div>
            </button>
        </div>
    </div>
</section>

<!-- Gallery Modal -->
<div id="project-gallery" class="hidden fixed inset-0 bg-black/90 z-50 overflow-y-auto">
    <div class="min-h-screen">
        <!-- Header -->
        <div class="sticky top-0 z-40 bg-white/95 backdrop-blur-sm border-b border-[#778da9]">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <button id="back-to-projects" class="flex items-center space-x-2 bg-[#0d1b2a] text-white px-4 py-2 rounded-lg font-medium hover:bg-[#1b263b] transition-colors duration-200">
                            <i class="fas fa-arrow-left"></i>
                            <span>{% trans "Back" %}</span>
                        </button>
                        <h3 id="gallery-title" class="text-xl font-bold text-[#0d1b2a]"></h3>
                    </div>
                    <div class="text-right">
                        <span id="image-counter" class="text-sm font-medium text-[#415a77]">
                            <span id="current-image">1</span> / <span id="total-images">0</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gallery Content -->
        <div class="container mx-auto px-6 py-8">
            <div id="gallery-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                <!-- Images will be loaded here dynamically -->
            </div>
            
            <!-- Navigation -->
            <div class="flex justify-center items-center space-x-4 mt-8">
                <button id="prev-btn" class="flex items-center space-x-2 bg-[#0d1b2a] text-white px-4 py-2 rounded-lg font-medium hover:bg-[#1b263b] transition-colors duration-200">
                    <i class="fas fa-chevron-left"></i>
                    <span>{% trans "Previous" %}</span>
                </button>
                <button id="next-btn" class="flex items-center space-x-2 bg-[#0d1b2a] text-white px-4 py-2 rounded-lg font-medium hover:bg-[#1b263b] transition-colors duration-200">
                    <span>{% trans "Next" %}</span>
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Lightbox -->
<div id="lightbox" class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-4">
    <div class="relative max-w-4xl w-full">
        <!-- Close Button -->
        <button id="close-lightbox" class="absolute -top-10 right-0 text-white text-xl hover:text-gray-300 transition-colors duration-200">
            <i class="fas fa-times"></i>
        </button>
        
        <!-- Image Container -->
        <div class="relative bg-white rounded-lg overflow-hidden shadow-xl">
            <img id="lightbox-image" src="" alt="" class="w-full h-auto max-h-[75vh] object-contain">
            
            <!-- Navigation -->
            <button id="lightbox-prev" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors duration-200">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button id="lightbox-next" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors duration-200">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <!-- Caption -->
        <div class="mt-3 text-center">
            <p id="lightbox-caption" class="text-white text-base font-medium"></p>
        </div>
    </div>
</div>

<script>
// Static URL base for Django
const STATIC_URL = '{% static "" %}';

// Project images data
const projectImages = {
    'abnoos': [
        'DSC00803.JPG',
        'DSC00806.JPG',
        'DSC00807.JPG',
    ],
    'dorsamehrkish': [
        '0O7A1259.jpg',
        '49ce9796-cc0b-45d2-8efe-74e2ab688b48.jpg',
        'ChatGPT Image Aug 3, 2025, 04_36_27 PM.png',
        'DJI_0070.JPG',
        'DJI_0080.JPG',
        'IMG-20240808-WA0031.jpg',
        'IMG-20240808-WA0033.jpg',
        'IMG-20250724-WA0001.jpg',
        'IMG-20250724-WA0002.jpg',
        'IMG-20250724-WA0003.jpg',
        'IMG-20250724-WA0004.jpg',
        'IMG-20250724-WA0005.jpg',
        'IMG-20250724-WA0006.jpg',
        'IMG-20250724-WA0007.jpg',
        'IMG-20250724-WA0008.jpg',
        'IMG_20250506_133528_980.jpg',
        'IMG_20250506_133558_810.jpg',
        'IMG_6102.JPG',
        'photo_2016-10-16_12-49-55 (1).jpg',
        'photo_2017-01-06_22-17-25 (1).jpg',
        'photo_2017-07-25_01-04-19.jpg',
    ],
    'emaratfarokh': [
        'ChatGPT Image Aug 3, 2025, 04_17_47 PM.png',
        'ED12.jpg',
        'ED30.jpg',
        'ED32.jpg',
        'ED34.jpg',
        'ED57.jpg',
        'ED63.jpg',
    ],
    'esperlos': [
        'DSC02834.JPG',
    ],
    'gheytariye': [
        '1 (1).jpg',
        'front 1.jpg',
        'front 2.jpg',
        'front 3.jpg',
        'shab.jpg',
    ],
    'narbon': [
        'IMG-20250716-WA0001.jpg',
        'IMG-20250716-WA0002.jpg',
        'IMG-20250716-WA0003.jpg',
        'IMG-20250716-WA0004.jpg',
        'IMG-20250716-WA0005.jpg',
    ],
    'narenjestan': [
        '20250604_182901.jpg',
        '20250604_182910.jpg',
        '20250604_182929.jpg',
        '20250604_183238.jpg',
        '20250604_183242.jpg',
    ],
    'roshana': [
        '1 (1).jpg',
        '2.jpg',
        '3.jpg',
        '4.jpg',
        '5 (3).jpg',
        '5.jpg',
    ],
    'sadinva': [
        'IMG_7959.JPG',
    ],
    'sakra': [
        'DSC01657.JPG',
    ],
};

const projectNames = {
    'abnoos': 'Abnoos',
    'dorsamehrkish': 'Dorsamehr Kish',
    'emaratfarokh': 'Emarat Farokh',
    'esperlos': 'Esperlos',
    'gheytariye': 'Gheytariye',
    'narbon': 'Narbon',
    'narenjestan': 'Narenjestan',
    'roshana': 'Roshana',
    'sadinva': 'Sadinva',
    'sakra': 'Sakra',
};

let currentProject = null;
let currentImageIndex = 0;
let currentImages = [];

// DOM elements
const projectButtons = document.querySelectorAll('.project-btn');
const projectGallery = document.getElementById('project-gallery');
const galleryTitle = document.getElementById('gallery-title');
const galleryGrid = document.getElementById('gallery-grid');
const backToProjectsBtn = document.getElementById('back-to-projects');
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const imageCounter = document.getElementById('image-counter');
const currentImageSpan = document.getElementById('current-image');
const totalImagesSpan = document.getElementById('total-images');
const lightbox = document.getElementById('lightbox');
const lightboxImage = document.getElementById('lightbox-image');
const lightboxCaption = document.getElementById('lightbox-caption');
const closeLightboxBtn = document.getElementById('close-lightbox');
const lightboxPrevBtn = document.getElementById('lightbox-prev');
const lightboxNextBtn = document.getElementById('lightbox-next');

// Event listeners
projectButtons.forEach(button => {
    button.addEventListener('click', () => {
        const project = button.getAttribute('data-project');
        showProjectGallery(project);
    });
});

backToProjectsBtn.addEventListener('click', hideProjectGallery);
prevBtn.addEventListener('click', showPreviousImage);
nextBtn.addEventListener('click', showNextImage);
closeLightboxBtn.addEventListener('click', closeLightbox);
lightboxPrevBtn.addEventListener('click', showPreviousLightboxImage);
lightboxNextBtn.addEventListener('click', showNextLightboxImage);

// Close lightbox when clicking outside
lightbox.addEventListener('click', (e) => {
    if (e.target === lightbox) {
        closeLightbox();
    }
});

// Keyboard navigation
document.addEventListener('keydown', (e) => {
    if (lightbox.classList.contains('hidden')) return;
    
    switch(e.key) {
        case 'Escape':
            closeLightbox();
            break;
        case 'ArrowLeft':
            showPreviousLightboxImage();
            break;
        case 'ArrowRight':
            showNextLightboxImage();
            break;
    }
});

function showProjectGallery(project) {
    currentProject = project;
    currentImages = projectImages[project] || [];
    currentImageIndex = 0;
    
    galleryTitle.textContent = projectNames[project];
    updateImageCounter();
    loadGalleryImages();
    
    projectGallery.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

function hideProjectGallery() {
    projectGallery.classList.add('hidden');
    document.body.style.overflow = '';
    currentProject = null;
    currentImages = [];
}

function loadGalleryImages() {
    galleryGrid.innerHTML = '';
    
    currentImages.forEach((image, index) => {
        const imgContainer = document.createElement('div');
        imgContainer.className = 'group bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 overflow-hidden cursor-pointer';
        
        const img = document.createElement('img');
        img.src = `${STATIC_URL}images/Offy/${currentProject}/${image}`;
        img.alt = `${projectNames[currentProject]} - ${image}`;
        img.className = 'w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300';
        
        // Loading state
        const loadingDiv = document.createElement('div');
        loadingDiv.className = 'absolute inset-0 flex items-center justify-center bg-[#e0e1dd]';
        loadingDiv.innerHTML = '<div class="animate-spin rounded-full h-6 w-6 border-b-2 border-[#415a77]"></div>';
        imgContainer.appendChild(loadingDiv);
        
        // Overlay
        const overlay = document.createElement('div');
        overlay.className = 'absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all duration-300 flex items-center justify-center';
        overlay.innerHTML = '';
        
        imgContainer.appendChild(img);
        imgContainer.appendChild(overlay);
        
        img.onload = function() {
            loadingDiv.style.opacity = '0';
            setTimeout(() => loadingDiv.remove(), 200);
        };
        
        img.onerror = function() {
            loadingDiv.innerHTML = '<div class="text-center text-[#778da9]"><i class="fas fa-image text-xl mb-1"></i><p class="text-xs">Image not found</p></div>';
        };
        
        imgContainer.addEventListener('click', () => {
            openLightbox(index);
        });
        
        galleryGrid.appendChild(imgContainer);
    });
}

function updateImageCounter() {
    currentImageSpan.textContent = currentImageIndex + 1;
    totalImagesSpan.textContent = currentImages.length;
}

function showPreviousImage() {
    if (currentImageIndex > 0) {
        currentImageIndex--;
        updateImageCounter();
        scrollToCurrentImage();
    }
}

function showNextImage() {
    if (currentImageIndex < currentImages.length - 1) {
        currentImageIndex++;
        updateImageCounter();
        scrollToCurrentImage();
    }
}

function scrollToCurrentImage() {
    const images = galleryGrid.querySelectorAll('img');
    if (images[currentImageIndex]) {
        images[currentImageIndex].closest('.group').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
        });
    }
}

function openLightbox(index) {
    currentImageIndex = index;
    lightboxImage.src = `${STATIC_URL}images/Offy/${currentProject}/${currentImages[index]}`;
    lightboxImage.alt = `${projectNames[currentProject]} - ${currentImages[index]}`;
    lightboxCaption.textContent = `${projectNames[currentProject]} - ${currentImages[index]}`;
    
    lightbox.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

function closeLightbox() {
    lightbox.classList.add('hidden');
    document.body.style.overflow = '';
}

function showPreviousLightboxImage() {
    if (currentImageIndex > 0) {
        currentImageIndex--;
        lightboxImage.src = `${STATIC_URL}images/Offy/${currentProject}/${currentImages[currentImageIndex]}`;
        lightboxImage.alt = `${projectNames[currentProject]} - ${currentImages[currentImageIndex]}`;
        lightboxCaption.textContent = `${projectNames[currentProject]} - ${currentImages[currentImageIndex]}`;
    }
}

function showNextLightboxImage() {
    if (currentImageIndex < currentImages.length - 1) {
        currentImageIndex++;
        lightboxImage.src = `${STATIC_URL}images/Offy/${currentProject}/${currentImages[currentImageIndex]}`;
        lightboxImage.alt = `${projectNames[currentProject]} - ${currentImages[currentImageIndex]}`;
        lightboxCaption.textContent = `${projectNames[currentProject]} - ${currentImages[currentImageIndex]}`;
    }
}
</script>
{% endblock %} 